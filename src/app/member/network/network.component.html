<!--
  Les relations du membre en cours sont affichées dans des onglets selon leur type
  - les amis confirmés
  - les demandes d'ajout d'amis reçues en attente
  - les demandes d'amis envoyées et en attente

  Les relations peuvent être sélectionnées :
  - affichage des données du membre ami dans une modale
  - actions possibles selon le statut de la relation : voir le profil, confirmation, rejet ou suppression de la relation

  La recherche d'amis se fait dans un 4ème onglet:
  - saisie d'un pseudo, nom ou prénom
  - sélection et affichage des données d'un membre dans un modale
  - possibilité de faire la demande d'ajout d'ami
 -->

<div class="network">
  <div class="col-md-8 mx-auto pt-2">
    <h5 class="text-white">Mon réseau d'amis <small></small></h5>
    <tabset [justified]="true">

      <!--======================================================================================================
             les amis confirmés
      ==========================================================================================================-->
      <tab heading="Amis">
        <ul class="list-group mt-3" *ngIf="confirmedRelations?.length; else noFriends">
          <li *ngFor="let relation of confirmedRelations" class="list-group-item list-group-item-action align-items-center"
            (click)="selectRelation(relation, relation_confirmed)">
            <div *ngIf="isRequester(relation); else isReceiver">

              <img class="rounded img-fluid" [src]="relation.receiver.photoUrl" width="12%" height="auto" alt="avatar">
              <div class="d-inline-block mx-2 loginStatus" [ngStyle]="{'background-color': relation.receiver.isLoggedIn ? 'green' : 'red' }" ></div>
              <div class="d-inline-block ml-2">
                {{ relation.receiver.pseudo | customTitleCase }}, {{ relation.receiver.firstName | customTitleCase }}
                {{ relation.receiver.lastName | customTitleCase }} <br>
                Pote depuis le {{ relation.modificationDate | date:'mediumDate':'':'fr' }}
              </div>
            </div>

            <ng-template #isReceiver>
              <img class="rounded img-fluid" [src]="relation.requester.photoUrl" width="12%" height="auto" alt="avatar">
              <div class="d-inline-block mx-2 loginStatus" [ngStyle]="{'background-color': relation.requester.isLoggedIn ? 'green' : 'red' }" ></div>
              <div class="d-inline-block ml-2">
                {{ relation.requester.pseudo | customTitleCase }}, {{ relation.requester.firstName | customTitleCase }}
                {{ relation.requester.lastName | customTitleCase }} <br>
                Pote depuis le {{ relation.modificationDate | date:'mediumDate':'':'fr' }}
              </div>
            </ng-template>
          </li>
        </ul>

        <ng-template #noFriends>
          <div class="list-group mt-3">
            <div class="list-group-item">
              <span> Je n'ai pas d'amis</span><br>
              <img class="img-fluid ml-1" src="../../../assets/img/no-friends.png" width="100" height="auto"
                alt="cat sitting">
            </div>
          </div>
        </ng-template>
      </tab>

      <!--======================================================================================================
             Demandes d'ajout reçues et à valider
      ==========================================================================================================-->

      <tab heading="Validation">
        <ul class="list-group mt-3" *ngIf="relationsToValidate?.length; else noValidations">
          <li *ngFor="let relation of relationsToValidate" class="list-group-item list-group-item-action  align-items-center"
            (click)="selectRelation(relation, relation_to_validate)">

            <img class="rounded img-fluid" [src]="relation.requester.photoUrl" width="12%" height="auto" alt="avatar">
            <div class="d-inline-block mx-2 loginStatus" [ngStyle]="{'background-color': relation.receiver.isLoggedIn ? 'green' : 'red' }" ></div>
            <div class="d-inline-block ml-2">
              {{ relation.requester.pseudo | customTitleCase }}, {{ relation.requester.firstName | customTitleCase }}
              {{ relation.requester.lastName | customTitleCase }} <br>
              Demande reçue le {{ relation.creationDate | date:'mediumDate':'':'fr' }}
            </div>
          </li>
        </ul>

        <ng-template #noValidations>
          <div class="list-group mt-3">
            <div class="list-group-item">
              <span> Je n'ai pas de demandes à valider.</span>
              <img class="img-fluid ml-1" src="../../../assets/img/bored.gif" width="100" height="auto" alt="bored cat">
            </div>
          </div>
        </ng-template>
      </tab>

      <!--======================================================================================================
             Demandes d'ajout envoyées en attente de confirmation
      ==========================================================================================================-->

      <tab heading="Attente">
        <ul class="list-group mt-3" *ngIf="relationsInWaiting?.length; else noneInWaiting">
          <li *ngFor="let relation of relationsInWaiting" class="list-group-item list-group-item-action  align-items-center"
            (click)="selectRelation(relation, relation_in_waiting)">

            <img class="rounded img-fluid" [src]="relation.receiver.photoUrl" width="12%" height="auto" alt="avatar">
            <div class="d-inline-block mx-2 loginStatus" [ngStyle]="{'background-color': relation.receiver.isLoggedIn ? 'green' : 'red' }" ></div>
            <div class="d-inline-block ml-2">
              {{ relation.receiver.pseudo | customTitleCase }}, {{ relation.receiver.firstName | customTitleCase }}
              {{ relation.receiver.lastName | customTitleCase }}<br>
              Demande envoyée le {{ relation.creationDate | date:'mediumDate':'':'fr' }}
            </div>
          </li>
        </ul>

        <ng-template #noneInWaiting>
          <div class="list-group mt-3">
            <div class="list-group-item">
              <span> Je n'ai pas de demandes en attente.</span>
              <img class="img-fluid ml-1" src="../../../assets/img/waiting.gif" width="100" height="auto"
                alt="cat waiting">
            </div>
          </div>
        </ng-template>
      </tab>

      <!--======================================================================================================
             Recherche membres
      ==========================================================================================================-->

      <tab heading="Recherche">

        <!-- formulaire de recherche -->
        <form class="form-inline my-2 mt-3 ">
          <input #searchTerm class="form-control w-100" type="search" placeholder="Recherche par pseudo, prénom ou nom"
            autofocus (keyup)="searchTerm$.next($event.target.value)">
        </form>

        <!-- résultats de la recherche -->
        <div *ngIf="members; else noResults">
          <ul class="list-group overflow-auto my-lg-0">
            <li class="list-group-item py-1 px-2 mt-2 text-left">
              Résultats pour "{{searchTerm.value}}"
            </li>
            <li *ngFor="let member of members" class="list-group-item list-group-item-action"
              (click)="selectMember(member)">
              <img class="rounded img-fluid" [src]="member.photoUrl" width="12%" height="auto" alt="avatar">
              <div class="d-inline-block mx-2 loginStatus" [ngStyle]="{'background-color': member.isLoggedIn ? 'green' : 'red'}"></div>
              {{ member.pseudo | customTitleCase }}, {{ member.firstName | customTitleCase }}
              {{ member.lastName | customTitleCase }}<br>
          </li>
          </ul>
        </div>
        <ng-template #noResults>
          <div class="list-group mt-3">
            <div class="list-group-item">
              <span>Aucun membre</span>
              <img class="img-fluid ml-1" src="../../../assets/img/no-results.png" width="50" height="auto"
                alt="no results">
            </div>
          </div>
        </ng-template>
      </tab>
    </tabset>
  </div>
</div>
